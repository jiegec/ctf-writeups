<!-- https://raw.githubusercontent.com/mkdocs/mkdocs/refs/heads/master/mkdocs/themes/mkdocs/base.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://jia.je/ctf-writeups/2025-12-20-tsg-ctf-2025/the-strongest-exponent-i-thought-2.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>The Strongest Exponent I Thought 2 - CTF Writeups by @jiegec</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <!-- added by @jiegec begin -->
        <link href=" https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css " rel="stylesheet">
        <!-- added by @jiegec end -->
        <!-- added by @jiegec begin -->
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <!-- added by @jiegec end -->

      <!-- added by @jiegec begin -->
      <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
      </script>
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() { dataLayer.push(arguments); }
          gtag('js', new Date());
      
          gtag('config', 'G-3109FRSVTT');
      </script>
      
      <script src="https://analytics.jiege.pro/api/script.js" data-site-id="1" defer></script>
      <!-- added by @jiegec end --> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">CTF Writeups by @jiegec</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../index.html" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/solution.html" class="nav-link">Writeups by Solution</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/pyjail.html" class="nav-link">Pyjail</a>
                            </li>
                            <li class="nav-item">
                                <a href="../puppeteer/index.html" class="nav-link">Redbud Puppeteer</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#the-strongest-exponent-i-thought-2" class="nav-link">The Strongest Exponent I Thought 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-bs-level="1"><a href="#tsgctf-2025-the-strongest-exponent-i-thought-2-writeup" class="nav-link">TSGCTF 2025: The Strongest Exponent I Thought 2 - Writeup</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#challenge-description" class="nav-link">Challenge Description</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#files" class="nav-link">Files</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#encryption-script-analysis" class="nav-link">Encryption Script Analysis</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#given-values" class="nav-link">Given Values</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#mathematical-analysis" class="nav-link">Mathematical Analysis</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#attack-plan" class="nav-link">Attack Plan</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#exploit-implementation" class="nav-link">Exploit Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#running-the-exploit" class="nav-link">Running the Exploit</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#flag" class="nav-link">Flag</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#why-this-works" class="nav-link">Why This Works</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#alternative-approaches" class="nav-link">Alternative Approaches</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#lessons-learned" class="nav-link">Lessons Learned</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#references" class="nav-link">References</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="the-strongest-exponent-i-thought-2">The Strongest Exponent I Thought 2</h1>
<p>Attachment:</p>
<pre class="highlight"><code class="language-python">from Crypto.Util.number import getPrime

flag = "TSGCTF{************REDACTED*************}"
assert len(flag) == 41

p = getPrime(1024)
q = getPrime(1024)
n = p * q
phi = (p - 1) * (q - 1)
# e = (p ** q) % phi
e = pow(p, q, phi)

m = int.from_bytes(flag.encode(), 'big')

c = pow(m, e, n)

print(f"n = {n}")
print(f"e = {e}")
print(f"c = {c}")</code></pre>
<pre class="highlight"><code>n = 12304937106495019948935823747896177539282746445389847240573471819615183350782871344655736641424538327646203132786364331680803172672565881147275872891374004325125755563779284122723272535648080869675254890421953184730207640610391499587131846028642837930573002266641165653436488988851379423113634977604789919048336354635258936662005400938712244679354370283198939324907588785304516972967767660681327553320071078132881601695691855892384395407410833039284741805467662060074582416349864492118156987242250334988709485218902717356401467908841000040063209207292376700158480563758869353523722467860892726428807123723391659759129
e = 4671508298202473062908098501122739212494104135822769469172957660169210197809353803016143135118329312461442335945081361046400708303845794518393283847717962634490620864727105047957787663674174103273199546275870204405433321074872048541293929182467813762150496313476918071127459153748615896909138251615692934309061780761262625941584853051868040264550530943071064965322169702801685784672354619433050569448706427815793570967672380706998764482936197619503081883603989897593357214325915544887558829367659538199805711114070709896237126163581049975456559860839042551241198296925972794823104585546475842981577962176035100657125
c = 734159268912236870326906291519339441060443190729549798304173425093568801503632263909956754998145543587462956329598121470425917551153360082681204702617948060192715494367013944150441511630518697760762122142274058030831598925419796406992806841961744715847324329596313556581670687011807097996415174407805818109493635886581027682687266023134960157243158377876713374560244314688652713790833693878860837389203062889825767981000866786402777089465218863064978825889452354777968576215646119739501361612158664806323278269221278619558106196445546507144889290265009352562267920470295408931325837487026801823417636759968187821134</code></pre>
<p>Solved by AI:</p>
<h1 id="tsgctf-2025-the-strongest-exponent-i-thought-2-writeup">TSGCTF 2025: The Strongest Exponent I Thought 2 - Writeup</h1>
<p><strong>Category:</strong> Cryptography<br />
<strong>Points:</strong> (Not specified)<br />
<strong>Author:</strong> (Not specified)<br />
<strong>Solved by:</strong> (Your name/team)</p>
<h2 id="challenge-description">Challenge Description</h2>
<blockquote>
<p>But this time, it's for real! The actual strongest character EVER!</p>
</blockquote>
<p>We're given a custom RSA-like cryptosystem with a special exponent construction. The challenge provides:</p>
<ul>
<li><code>problem.py</code> - The encryption script</li>
<li><code>output.txt</code> - The encrypted output containing <code>n</code>, <code>e</code>, and <code>c</code></li>
</ul>
<h2 id="files">Files</h2>
<ul>
<li><code>problem.py</code> - Encryption script</li>
<li><code>output.txt</code> - Contains <code>n</code>, <code>e</code>, and <code>c</code> values</li>
</ul>
<h2 id="encryption-script-analysis">Encryption Script Analysis</h2>
<pre class="highlight"><code class="language-python">from Crypto.Util.number import getPrime

flag = "TSGCTF{************REDACTED*************}"
assert len(flag) == 41

p = getPrime(1024)
q = getPrime(1024)
n = p * q
phi = (p - 1) * (q - 1)
# e = (p ** q) % phi
e = pow(p, q, phi)

m = int.from_bytes(flag.encode(), 'big')

c = pow(m, e, n)

print(f"n = {n}")
print(f"e = {e}")
print(f"c = {c}")</code></pre>
<p>The key difference from standard RSA is the exponent:
- Standard RSA: <code>e</code> is typically small (like 65537) and coprime with <code>phi</code>
- This challenge: <code>e = p^q mod phi</code></p>
<h2 id="given-values">Given Values</h2>
<pre class="highlight"><code>n = 12304937106495019948935823747896177539282746445389847240573471819615183350782871344655736641424538327646203132786364331680803172672565881147275872891374004325125755563779284122723272535648080869675254890421953184730207640610391499587131846028642837930573002266641165653436488988851379423113634977604789919048336354635258936662005400938712244679354370283198939324907588785304516972967767660681327553320071078132881601695691855892384395407410833039284741805467662060074582416349864492118156987242250334988709485218902717356401467908841000040063209207292376700158480563758869353523722467860892726428807123723391659759129
e = 4671508298202473062908098501122739212494104135822769469172957660169210197809353803016143135118329312461442335945081361046400708303845794518393283847717962634490620864727105047957787663674174103273199546275870204405433321074872048541293929182467813762150496313476918071127459153748615896909138251615692934309061780761262625941584853051868040264550530943071064965322169702801685784672354619433050569448706427815793570967672380706998764482936197619503081883603989897593357214325915544887558829367659538199805711114070709896237126163581049975456559860839042551241198296925972794823104585546475842981577962176035100657125
c = 734159268912236870326906291519339441060443190729549798304173425093568801503632263909956754998145543587462956329598121470425917551153360082681204702617948060192715494367013944150441511630518697760762122142274058030831598925419796406992806841961744715847324329596313556581670687011807097996415174407805818109493635886581027682687266023134960157243158377876713374560244314688652713790833693878860837389203062889825767981000866786402777089465218863064978825889452354777968576215646119739501361612158664806323278269221278619558106196445546507144889290265009352562267920470295408931325837487026801823417636759968187821134</code></pre>
<h2 id="mathematical-analysis">Mathematical Analysis</h2>
<h3 id="key-insight">Key Insight</h3>
<p>Given <code>e = p^q mod phi</code> where <code>phi = (p-1)*(q-1)</code>:</p>
<ol>
<li><code>e ≡ p^q (mod phi)</code></li>
<li>Since <code>phi = (p-1)*(q-1)</code>, we have <code>e ≡ p^q (mod (p-1))</code> (when <code>a = b (mod c * d)</code>, you known that <code>a = b (mod c)</code>)</li>
<li>Because <code>p ≡ 1 (mod (p-1))</code>, we get <code>p^q ≡ 1^q ≡ 1 (mod (p-1))</code></li>
<li>Therefore: <code>e ≡ 1 (mod (p-1))</code></li>
</ol>
<p>This means <code>p-1</code> divides <code>e-1</code>.</p>
<h3 id="consequences">Consequences</h3>
<p>Since <code>p-1</code> divides <code>e-1</code>, we can write <code>e-1 = k*(p-1)</code> for some integer <code>k</code>.</p>
<p>For any integer <code>a</code> coprime with <code>n</code> (like <code>a=2</code>):
- By Fermat's little theorem: <code>a^(p-1) ≡ 1 (mod p)</code>
- Therefore: <code>a^(e-1) = a^(k*(p-1)) ≡ 1^k ≡ 1 (mod p)</code></p>
<p>Thus <code>p</code> divides <code>a^(e-1) - 1</code>.</p>
<p>Since <code>p</code> also divides <code>n</code>, we have:
<pre class="highlight"><code>gcd(a^(e-1) - 1, n) = p</code></pre></p>
<p>This allows us to factor <code>n</code>!</p>
<h2 id="attack-plan">Attack Plan</h2>
<ol>
<li>Compute <code>gcd(2^(e-1) - 1, n)</code> to obtain <code>p</code></li>
<li>Compute <code>q = n // p</code></li>
<li>Compute <code>phi = (p-1)*(q-1)</code></li>
<li>Compute <code>d = e^(-1) mod phi</code> (modular inverse)</li>
<li>Decrypt: <code>m = c^d mod n</code></li>
<li>Convert <code>m</code> to bytes to get the flag</li>
</ol>
<h2 id="exploit-implementation">Exploit Implementation</h2>
<pre class="highlight"><code class="language-python">#!/usr/bin/env python3
from Crypto.Util.number import long_to_bytes
import math

# Given values
n = 12304937106495019948935823747896177539282746445389847240573471819615183350782871344655736641424538327646203132786364331680803172672565881147275872891374004325125755563779284122723272535648080869675254890421953184730207640610391499587131846028642837930573002266641165653436488988851379423113634977604789919048336354635258936662005400938712244679354370283198939324907588785304516972967767660681327553320071078132881601695691855892384395407410833039284741805467662060074582416349864492118156987242250334988709485218902717356401467908841000040063209207292376700158480563758869353523722467860892726428807123723391659759129
e = 4671508298202473062908098501122739212494104135822769469172957660169210197809353803016143135118329312461442335945081361046400708303845794518393283847717962634490620864727105047957787663674174103273199546275870204405433321074872048541293929182467813762150496313476918071127459153748615896909138251615692934309061780761262625941584853051868040264550530943071064965322169702801685784672354619433050569448706427815793570967672380706998764482936197619503081883603989897593357214325915544887558829367659538199805711114070709896237126163581049975456559860839042551241198296925972794823104585546475842981577962176035100657125
c = 734159268912236870326906291519339441060443190729549798304173425093568801503632263909956754998145543587462956329598121470425917551153360082681204702617948060192715494367013944150441511630518697760762122142274058030831598925419796406992806841961744715847324329596313556581670687011807097996415174407805818109493635886581027682687266023134960157243158377876713374560244314688652713790833693878860837389203062889825767981000866786402777089465218863064978825889452354777968576215646119739501361612158664806323278269221278619558106196445546507144889290265009352562267920470295408931325837487026801823417636759968187821134

# Step 1: Factor n using the vulnerability
pow_result = pow(2, e-1, n)
p = math.gcd(pow_result - 1, n)
q = n // p

print(f"Found p: {p}")
print(f"Found q: {q}")
print(f"Verification: n == p*q? {n == p*q}")

# Step 2: Compute phi and decryption exponent
phi = (p-1)*(q-1)
d = pow(e, -1, phi)  # Modular inverse

# Step 3: Decrypt
m = pow(c, d, n)

# Step 4: Convert to flag
flag = long_to_bytes(m)
print(f"Flag: {flag.decode()}")</code></pre>
<h2 id="running-the-exploit">Running the Exploit</h2>
<pre class="highlight"><code>$ python3 exp.py
Found p: 105937009553883862577967493979820300930239452369039712050865514405472077146174715149934438264344045317716403466474742353074706323059068441839265251729695958013724754515351900282908744725502755279101079244363313515315674647685808381377886490847262229336888471590571794486450616598202909282796888725875837701253
Found q: 116153336386527217696396836098940101996561406780282082275084959504295159477378988046243098201524326207914965592350955440641219375853263533368698528142124545547342363268572615298653923480284789760821739772188389370773347340174102358172495894629846892502629301625010753345575197711382718272022098628309152764293
Verification: n == p*q? True
Flag: TSGCTF{My_power_is_too_dangerous_to_use!}</code></pre>
<h2 id="flag">Flag</h2>
<p><code>TSGCTF{My_power_is_too_dangerous_to_use!}</code></p>
<h2 id="why-this-works">Why This Works</h2>
<p>The vulnerability stems from the custom exponent construction <code>e = p^q mod phi</code>. While this might seem strong at first glance, it creates a mathematical relationship <code>e ≡ 1 (mod (p-1))</code>. This is essentially leaking a multiple of <code>(p-1)</code>, which is enough to factor <code>n</code> using the GCD attack.</p>
<p>In standard RSA, we choose <code>e</code> to be a small, fixed number (like 65537) that's coprime with <code>phi</code>. This challenge demonstrates why deviating from well-established cryptographic constructions can introduce vulnerabilities.</p>
<h2 id="alternative-approaches">Alternative Approaches</h2>
<ol>
<li>
<p><strong>Using different <code>a</code> values</strong>: The attack works with any <code>a</code> coprime to <code>n</code>, not just <code>a=2</code>. If <code>gcd(2^(e-1) - 1, n) = 1</code> (which doesn't happen here), we could try <code>a=3</code>, <code>a=5</code>, etc.</p>
</li>
<li>
<p><strong>Pollard's p-1 algorithm</strong>: Since we know <code>e-1</code> is a multiple of <code>p-1</code>, we could potentially use Pollard's p-1 algorithm with <code>e-1</code> as the bound. However, the GCD attack is simpler and more efficient in this case.</p>
</li>
</ol>
<h2 id="lessons-learned">Lessons Learned</h2>
<ol>
<li><strong>Don't roll your own crypto</strong>: Custom cryptographic constructions often have hidden vulnerabilities.</li>
<li><strong>Mathematical relationships matter</strong>: The relationship <code>e ≡ 1 (mod (p-1))</code> seems innocuous but is fatal for RSA security.</li>
<li><strong>GCD attacks are powerful</strong>: Knowing a multiple of <code>(p-1)</code> or <code>(q-1)</code> can lead to factorization.</li>
<li><strong>Fermat's little theorem is useful</strong>: <code>a^(p-1) ≡ 1 (mod p)</code> is a fundamental tool in many cryptographic attacks.</li>
</ol>
<h2 id="references">References</h2>
<ul>
<li>RSA cryptosystem</li>
<li>Fermat's little theorem</li>
<li>GCD-based factorization attacks</li>
<li>Pollard's p-1 algorithm</li>
</ul></div>

                <!-- added by @jiegec begin -->
                <div class="col-md-3"></div>
                <div class="col-md-9">
                  <script src="https://giscus.app/client.js"
                      data-repo="jiegec/ctf-writeups"
                      data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE1MzAxODQ="
                      data-category="General"
                      data-category-id="DIC_kwDOCQgqyM4CvbYX"
                      data-mapping="pathname"
                      data-strict="1"
                      data-reactions-enabled="1"
                      data-emit-metadata="0"
                      data-input-position="top"
                      data-theme="light"
                      data-lang="en"
                      data-loading="lazy"
                      crossorigin="anonymous"
                      async>
                  </script>
                </div>
                <!-- added by @jiegec end -->
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2025 Jiajie Chen</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
