<!-- https://raw.githubusercontent.com/mkdocs/mkdocs/refs/heads/master/mkdocs/themes/mkdocs/base.html -->
<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://jia.je/ctf-writeups/2025-09-27-sunshine-ctf-2025/space-race.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Space Race - CTF Writeups by @jiegec</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <!-- added by @jiegec begin -->
        <link href=" https://cdn.jsdelivr.net/npm/prismjs@1.30.0/themes/prism.min.css " rel="stylesheet">
        <!-- added by @jiegec end -->
        <!-- added by @jiegec begin -->
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/components/prism-core.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/prismjs@1.30.0/plugins/autoloader/prism-autoloader.min.js"></script>
        <!-- added by @jiegec end -->

      <!-- added by @jiegec begin -->
      <script defer src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
      </script>
      
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-3109FRSVTT"></script>
      <script>
          window.dataLayer = window.dataLayer || [];
          function gtag() { dataLayer.push(arguments); }
          gtag('js', new Date());
      
          gtag('config', 'G-3109FRSVTT');
      </script>
      
      <script src="https://analytics.jiege.pro/api/script.js" data-site-id="1" defer></script>
      <!-- added by @jiegec end --> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">CTF Writeups by @jiegec</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../index.html" class="nav-link">Home</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/solution.html" class="nav-link">Writeups by Solution</a>
                            </li>
                            <li class="nav-item">
                                <a href="../misc/pyjail.html" class="nav-link">Pyjail</a>
                            </li>
                            <li class="nav-item">
                                <a href="../puppeteer/index.html" class="nav-link">Redbud Puppeteer</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#space-race" class="nav-link">Space Race</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="space-race">Space Race</h1>
<pre class="highlight"><code>NASA was so excited to send their new unmanned rover out to pick up some stranded astronauts that they forgot to actually write the software to control it. Can you take a look at the onboard ECU software and see if you can find a way to establish communications?

If worse comes to worst, maybe they CAN BUS the astronauts back....

    the server binary has been updated to not be stripped

nc chal.sunshinectf.games 25102 </code></pre>
<p>Decompile in IDA:</p>
<pre class="highlight"><code class="language-c">while ( 1 )
{
  v58 = bufio__ptr_Reader_ReadBytes(&amp;b, 0xAu);
  if ( v58._r1.tab )
    break;
  v32 = v58._r0.cap;
  v31 = v58._r0.len;
  v40.array = v58._r0.array;
  p_main_ControlMsg = (main_ControlMsg *)runtime_newobject((runtime__type_1 *)&amp;RTYPE_main_ControlMsg);
  v = (main_ControlMsg_0 *)p_main_ControlMsg;
  p_main_ControlMsg-&gt;T.ptr = 0;
  p_main_ControlMsg-&gt;Frame.ptr = 0;
  v66.len = v31;
  v66.cap = v32;
  v66.array = v40.array;
  v67 = main_trim(v66);
  v55._type = (runtime__type_0 *)&amp;RTYPE__ptr_main_ControlMsg;
  v55.data = v;
  if ( !(unsigned __int64)encoding_json_Unmarshal(v67, v55).tab )
  {
    str = v-&gt;T.str;
    if ( v-&gt;T.len == 3 &amp;&amp; *(_WORD *)str == 0x6163 &amp;&amp; str[2] == 110 )
    {
      v65.len = v-&gt;Frame.len;
      if ( v65.len )
      {
        v65.str = v-&gt;Frame.str;
        v68 = runtime_stringtoslicebyte((runtime_tmpBuf *)buf, v65);
        raw_array = v68.array;
        v30 = v68.cap;
        v9 = (unsigned __int128)encoding_hex_Decode(v68, v68);
        if ( (unsigned __int64)v9 &gt; v30 )
          runtime_panicSliceAcap();
        if ( !*((_QWORD *)&amp;v9 + 1) &amp;&amp; (__int64)v9 &gt;= 3 )
        {
          v10 = raw_array;
          v11 = *(_WORD *)raw_array;
          v12 = raw_array[2] &amp; 0xF;
          if ( (unsigned __int64)v12 &lt;= 8 &amp;&amp; (__int64)v9 &gt;= v12 + 3 )
          {
            if ( (unsigned __int64)(v12 + 3) &lt; 3 )
              runtime_panicSliceB();
            v13 = rover;
            v14 = ((__int64)(3 - v30) &gt;&gt; 63) &amp; 3;
            v15 = &amp;raw_array[v14];
            if ( _InterlockedCompareExchange((volatile signed __int32 *)&amp;rover-&gt;mu, 1, 0) )
            {
              dlc = v12;
              v36 = v14;
              v40.len = (int)&amp;v10[v14];
              v29 = v11;
              sync__ptr_Mutex_lockSlow(&amp;v13-&gt;mu);
              v13 = rover;
              v14 = v36;
              v10 = raw_array;
              v11 = v29;
              v12 = dlc;
              v15 = (uint8 *)v40.len;
            }
            v16 = __ROL2__(v11, 8) &amp; 0x7FF;
            if ( v16 &gt; 0x202u )
            {
              switch ( v16 )
              {
                case 0x203u:
                  v13-&gt;vel = v13-&gt;vel * 0.65;
                  v13-&gt;msg.len = 6;
                  if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                    goto LABEL_58;
                  v13-&gt;msg.str = (uint8 *)"Brake!";
                  break;
                case 0x204u:
                  v13-&gt;steerPct = 0;
                  v13-&gt;heading = v13-&gt;heading * 0.9;
                  v13-&gt;msg.len = 14;
                  if ( !*(_DWORD *)&amp;runtime_writeBarrier.enabled )
                  {
                    v13-&gt;msg.str = (uint8 *)"Stabilizers on";
                    break;
                  }
L_58:
                  runtime_gcWriteBarrierDX();
                  break;
                case 0x205u:
                  if ( v13-&gt;status.len != 2 || *(_WORD *)v13-&gt;status.str != 27503 )
                  {
                    v13-&gt;s = 0.0;
                    v13-&gt;x = 0.0;
                    v13-&gt;vel = 0.0;
                    *(_OWORD *)&amp;v13-&gt;throttlePct = 0;
                    v13-&gt;status.len = 2;
                    if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                      runtime_gcWriteBarrierDX();
                    else
                      v13-&gt;status.str = (uint8 *)"ok";
                    v13-&gt;msg.len = 14;
                    if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                      runtime_gcWriteBarrierSI();
                    else
                      v13-&gt;msg.str = (uint8 *)"Reset to start";
                  }
                  break;
                default:
L_73:
                  a = 0;
                  v23 = runtime_convT16(v16);
                  *(_QWORD *)&amp;a = &amp;RTYPE_uint16;
                  *((_QWORD *)&amp;a + 1) = v23;
                  v61.str = (uint8 *)"Unknown CAN 0x%03X";
                  v61.len = 18;
                  v64.len = 1;
                  v64.cap = 1;
                  v64.array = (interface__0 *)&amp;a;
                  v24 = fmt_Sprintf(v61, v64);
                  v13 = rover;
                  rover-&gt;msg.len = v24.len;
                  if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                    runtime_gcWriteBarrier();
                  else
                    v13-&gt;msg.str = v24.str;
                  break;
              }
            }
            else if ( v16 == 513 )
            {
              if ( v12 &gt;= 1 )
              {
                v17 = v10[v14];
                if ( v17 &gt; 100 )
                  v17 = 100;
                v13-&gt;throttlePct = v17;
                a = 0;
                v18 = runtime_convT64(v13-&gt;throttlePct);
                *(_QWORD *)&amp;a = &amp;RTYPE_int;
                *((_QWORD *)&amp;a + 1) = v18;
                v59.str = (uint8 *)"Throttle %d%%";
                v59.len = 13;
                v62.len = 1;
                v62.cap = 1;
                v62.array = (interface__0 *)&amp;a;
                v19 = fmt_Sprintf(v59, v62);
                v13 = rover;
                rover-&gt;msg.len = v19.len;
                if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                  runtime_gcWriteBarrier();
                else
                  v13-&gt;msg.str = v19.str;
              }
            }
            else
            {
              if ( v16 != 514 )
                goto LABEL_73;
              if ( v12 &gt;= 1 )
              {
                v20 = (char)*v15;
                if ( v20 &gt;= -100 )
                {
                  if ( v20 &gt; 100 )
                    v20 = 100;
                }
                else
                {
                  v20 = -100;
                }
                v13-&gt;steerPct = v20;
                a = 0;
                v21 = runtime_convT64(v13-&gt;steerPct);
                *(_QWORD *)&amp;a = &amp;RTYPE_int;
                *((_QWORD *)&amp;a + 1) = v21;
                v60.str = (uint8 *)"Steer %d%%";
                v60.len = 10;
                v63.len = 1;
                v63.cap = 1;
                v63.array = (interface__0 *)&amp;a;
                v22 = fmt_Sprintf(v60, v63);
                v13 = rover;
                rover-&gt;msg.len = v22.len;
                if ( *(_DWORD *)&amp;runtime_writeBarrier.enabled )
                  runtime_gcWriteBarrier();
                else
                  v13-&gt;msg.str = v22.str;
              }
            }
            v25 = _InterlockedExchangeAdd((volatile signed __int32 *)&amp;v13-&gt;mu, 0xFFFFFFFF);
            if ( v25 != 1 )
              sync__ptr_Mutex_unlockSlow(&amp;v13-&gt;mu, v25 - 1);
          }
        }
      }
    }
  }
}</code></pre>
<p>The JSON format to sent is shown in <code>client.py</code>:</p>
<pre class="highlight"><code>TODO: Implement the controls for the rover client!

{"t":"can","frame":"0123456789abcdef"}</code></pre>
<p>Reading the code, we know that the frame format is:</p>
<ol>
<li>two bytes of opcode</li>
<li>one byte of payload length</li>
<li>variable length of payload</li>
</ol>
<p>Possible opcodes:</p>
<ol>
<li>0202: steer with one argument, -100 to 100</li>
<li>0203: brake</li>
<li>0204: stablizer</li>
<li>0201: throttle with one argument, 0 to 100</li>
</ol>
<p>We map these opcodes to keyboard input:</p>
<pre class="highlight"><code class="language-python">elif e.key == pygame.K_LEFT:
    # -100
    net.sock.send((json.dumps({
        "t": "can",
        "frame": "0202019c"
    }) + "\n").encode())
elif e.key == pygame.K_RIGHT:
    # +100
    net.sock.send((json.dumps({
        "t": "can",
        "frame": "02020164"
    }) + "\n").encode())
elif e.key == pygame.K_b:
    # brake
    net.sock.send((json.dumps({
        "t": "can",
        "frame": "020300"
    }) + "\n").encode())
elif e.key == pygame.K_s:
    # stablizer
    net.sock.send((json.dumps({
        "t": "can",
        "frame": "020400"
    }) + "\n").encode())
elif e.key == pygame.K_r:
    # throttle
    net.sock.send((json.dumps({
        "t": "can",
        "frame": "02010164"
    }) + "\n").encode())
print(e.key)</code></pre>
<p>Then we can play the game by pressing <code>r</code> and then <code>Left/Right</code> to avoid crashing into the obstacles. After winning, the flag is shown.</p>
<p>Flag: <code>sun{r3d_r0v3r_c0m3_0v3r}</code>.</p></div>

                <!-- added by @jiegec begin -->
                <div class="col-md-3"></div>
                <div class="col-md-9">
                  <script src="https://giscus.app/client.js"
                      data-repo="jiegec/ctf-writeups"
                      data-repo-id="MDEwOlJlcG9zaXRvcnkxNTE1MzAxODQ="
                      data-category="General"
                      data-category-id="DIC_kwDOCQgqyM4CvbYX"
                      data-mapping="pathname"
                      data-strict="1"
                      data-reactions-enabled="1"
                      data-emit-metadata="0"
                      data-input-position="top"
                      data-theme="light"
                      data-lang="en"
                      data-loading="lazy"
                      crossorigin="anonymous"
                      async>
                  </script>
                </div>
                <!-- added by @jiegec end -->
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
                <p>Copyright &copy; 2025 Jiajie Chen</p>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
